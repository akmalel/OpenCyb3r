import requests
import time
import json

def get_contributors(owner, repo):
    url = f"https://api.github.com/repos/{owner}/{repo}/contributors"
    response = requests.get(url)

    if response.status_code == 200:
        contributors = response.json()
        leaderboard = []

        for contributor in contributors:
            leaderboard.append({
                "username": contributor["login"],
                "contributions": contributor["contributions"],
                "avatar_url": contributor["avatar_url"]
            })

        return sorted(leaderboard, key=lambda x: x["contributions"], reverse=True)
    else:
        print(f"Failed to fetch contributors: {response.status_code}")
        return []

def generate_html(leaderboard, owner, repo):
    html = f"""
    <!DOCTYPE html>
    <html>
    <head>
        <title>{repo} Leaderboard</title>
        <style>
            body {{ 
                font-family: Arial, sans-serif; 
                margin: 2rem; 
                background: linear-gradient(135deg, #ff9a9e, #fad0c4, #fbc2eb, #a18cd1);
                background-size: 400% 400%;
                animation: gradientBackground 15s ease infinite;
            }}
            table {{ border-collapse: collapse; width: 100%; }}
            th, td {{ border: 1px solid #ddd; padding: 8px; text-align: left; }}
            th {{ background-color: #f2f2f2; }}
            @keyframes gradientBackground {{
                0% {{ background-position: 0% 50%; }}
                50% {{ background-position: 100% 50%; }}
                100% {{ background-position: 0% 50%; }}
            }}
            .pixel {{
                position: absolute;
                width: 5px;
                height: 5px;
                background-color: rgba(255, 255, 255, 0.8);
                animation: movePixel 10s linear infinite;
            }}
            @keyframes movePixel {{
                from {{ transform: translateY(0) translateX(0); }}
                to {{ transform: translateY(100vh) translateX(100vw); }}
            }}
            .avatar {{
                width: 40px;
                height: 40px;
                border-radius: 50%;
                margin-right: 10px;
                vertical-align: middle;
            }}
        </style>
    </head>
    <body>
        <h1>Leaderboard for {owner}/{repo}</h1>
        <table>
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Contributor</th>
                    <th>Contributions</th>
                </tr>
            </thead>
            <tbody>
    """
    for rank, contributor in enumerate(leaderboard, start=1):
        html += f"""
                <tr>
                    <td>{rank}</td>
                    <td><img src='{contributor['avatar_url']}' alt='Avatar' class='avatar'>{contributor['username']}</td>
                    <td>{contributor['contributions']}</td>
                </tr>
        """
    html += """
            </tbody>
        </table>
        <script>
            function createPixel() {{
                const pixel = document.createElement('div');
                pixel.classList.add('pixel');
                pixel.style.top = `${Math.random() * 100}vh`;
                pixel.style.left = `${Math.random() * 100}vw`;
                pixel.style.animationDuration = `${Math.random() * 20 + 5}s`;
                document.body.appendChild(pixel);

                setTimeout(() => {{
                    pixel.remove();
                }}, 20000);
            }}
            setInterval(createPixel, 300);
        </script>
    </body>
    </html>
    """
    return html

def save_html_to_file(html, filename="leaderboard.html"):
    with open(filename, "w") as file:
        file.write(html)

if __name__ == "__main__":
    owner = input("Enter the GitHub repository owner: ")
    repo = input("Enter the GitHub repository name: ")

    print("Generating GitHub repository leaderboard...")

    leaderboard = get_contributors(owner, repo)

    if leaderboard:
        html = generate_html(leaderboard, owner, repo)
        save_html_to_file(html)
        print("Leaderboard HTML generated and saved as leaderboard.html. Upload this file to GitHub Pages to make it viewable.")
    else:
        print("No contributors found or failed to retrieve data.")
